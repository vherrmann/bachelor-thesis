\section{Complexity of input partitions}
\label{ch:partitions}

% TODO: what kind of shapes a d.t. â€¦
In the following we will analyze what shape the graph of a \rdtlifsnn has.
Since the output of the following layers only depends on the spike trains of the first hidden layer, those layers are only able to merge different output regions of the first hidden layer. We will therefore only study the output landscape of the first hidden layer.

We can therefore simplify the notation in this section by writing \(W,b,V,Î²,Ï‘,u,s\) for \(W^{[1]},b^{[1]},V^{[1]},Î²^{[1]},Ï‘^{[1]},u^{[1]},s^{[1]}\) respectively. Since we are using direct encoding, we will write \(x\) for \(s^{[0]}âˆˆâ„^{n_0}\):
% We can assume \(n_0=n_1=n\), \(W=I_{n_1}\) and \(b=0_{n_1}\), since we can instead just precompose our SNN \(Î¦\) with \(xâ†¦Wx+b\). Since precomposition can only decrease the number of different values, we can instead just study \(Î¦\) by itself.
  \begin{align}
    i(t) & = Î±i(t-1)+Wx+Vs(t-1) \\
    p(t) & = Î²u(t-1)+i(t)+b \\
    s(t) & = H(p(t)-Ï‘1_n) \\
    u(t) & = p(t)-Ï‘s(t)
  \end{align}

By using the simplified notation, we obtain the following explicitely formulated definitions from~\cref{lem:non-recursive-defs} for \(xâˆˆâ„^{n_0}\) and \(s:\{0,1\}^{n_1Ã—t'}\) for \(t'\) chosen such that the following equations are well-defined:
\begin{align}
    i(t;x;s_p) &= Î±^ti(0)+\sum_{k=1}^tÎ±^{t-k}\left(Wx+Vs_p(k-1)\right), \\\label{eq:1}
    u(t;x;s_p) &= Î²^tu(0)+\sum_{k=1}^tÎ²^{t-k}\left(i(k;x;s_p)+b-Ï‘s_p(k)\right), \\\label{eq:2}
    p(t;x;s_p) &= Î²^tu(0)+\sum_{k=1}^tÎ²^{t-k}\left(i(k;x;s_p)+b\right)-Ï‘\sum_{k=1}^{t-1}Î²^{t-k}s_p(k), \\
    s(t;x;s_p) &= H(p(t;x;s_p)-Ï‘1_{n_1})
\end{align}

\begin{remark}\label{rem:regions-non-recursive-defs}
  We will sometimes just write \(i(t;x)\) instead of \(i(t;x;s_p)\), with which we imply to use \(s\) (at \(x\)) for \(s_p\). The same holds for \(u,p,s\).

  It is furthermore quite obvious that \(i\) grows linear in \(x\), given fixed \(s_p\). The same holds therefore for \(u\) and \(p\). Further, the interdependence of the different components in \(i/u/p/s\) is gone using a constant \(s_p\). We can therefore split e.g. \(p\) into functions \(p_{i;s_p}\) such that \(p(t,x)=p_{1;s_p}(t;x_1)Ã—â€¦Ã—p_{n_1;s_p}(t;x_{n_1})\).

  The functions \(i_{i;s_p}\),\(u_{i;s_p}\),\(p_{i;s_p}\) are not only linear in \(x\), but also grow monotonically in \(x\) since \(Î±,Î²â‰¥0\). If \(tâ‰¥1\), then \(i_{i;s_p}\),\(u_{i;s_p}\),\(p_{i;s_p}\) grow even strictly monotonically in \(x\).

  So we in particular have that \(p\) to is growing monotonically (regarding by-component ordering) on fixed \(s_p\).
  Since \(H\) is a monotonically growing function, \(s\) is also growing monotonically with fixed \(s_p\).
\end{remark}
We will examine the graph by investigating the shape and location of the constant regions of a \rdtlifsnn:

\begin{definition}
  The set of constant regions of a \rdtlifsnn \(Î¦\) is defined as the partition
  \[ C_Î¦â‰”\{R(Î¦)^{-1}(\{y\})\mid yâˆˆ\operatorname{im}(R(Î¦))\} \]
  of \(â„^{n_0}\). A constant region with spike train \(s'âˆˆ\{0,1\}^{n_1Ã—T}\), of the first layer of a \rdtlifsnn \(Î¦\) is defined as
  \[ C_{s'}â‰”\{xâˆˆâ„^{n_0}\midâˆ€_{tâˆˆ[T]}s(t;x)=s'(t)\} \]
  We further notate the set of these regions by \( C_{Î¦,1}â‰”\{C_{s'}\mid s'âˆˆ\{0,1\}^{n_1Ã—T},C_{s'}â‰ âˆ…\} \).
\end{definition}

% TODO: remark about the connection between C_Î¦ and C_{Î¦,1}

\begin{proposition}\label{prop:const-regions-cuboids}
  The constant regions of the first layer of a \rdtlifsnn \(Î¦\) with \(W=I_{n_1}\) are half-open cuboids. In particular, let \(C_{s'}=âŸ¦x^{s'},y^{s'}â¦†âˆˆC_{Î¦,1}\) be a constant region. Then
  \[ x^{s'}_i =\sup_{\substack{tâˆˆ[T] \\ s'_i(t)=1}}g_i(t;s')\qquad y^{s'}_i =\inf_{\substack{tâˆˆ[T] \\ s'_i(t)=0}}g_i(t;s') \]
  where we use the conventions \(\inf âˆ…=âˆ\) and \(\sup âˆ…=-âˆ\).
\end{proposition}

\begin{lemma}\label{lem:invert-p}
  There is a function \(g(t;s_p)\) such that \(âˆ€_{iâˆˆ[n_1]}s_i(t;x;s_p)=1â‡”âŸ¨w_i,xâŸ©â‰¥g_i(t;s_p)\) defined by
  \[ g(t;s_{p})â‰”-\frac{\sum_{k=1}^tÎ²^{t-k}\left(Î±^ki(0)+b+\sum_{l=1}^kÎ±^{k-l}Vs_p(l-1)\right) +Î²^tu(0)-Ï‘\left(1+\sum_{k=1}^{t-1}Î²^{t-k}s_p(k)\right)}{\sum_{k=1}^tÎ²^{t-k}\sum_{l=1}^kÎ±^{k-l}} \]
  Where \(w_i\) denotes the \(i\)-th row vector of \(W\).
\end{lemma}

\begin{proof}[\proofofref{lem:invert-p}]
We compute for a \(iâˆˆ[n_1]\) using~\cref{lem:non-recursive-defs}:
\begin{align*}
 & H(p_i(t;x;s_p)-Ï‘) \\
 &= H\left(\sum_{k=1}^tÎ²^{t-k}\left(i_i(k;x;s_p)+b_i\right)+\underset{(*)}{\underbrace{Î²^tu_i(0)-Ï‘\left(1+\sum_{k=1}^{t-1}Î²^{t-k}(s_p)_i(k)\right)}}\right)  \\
 &= H\left(\sum_{k=1}^tÎ²^{t-k}\left(Î±^ki_i(0)+\sum_{l=1}^kÎ±^{k-l}\left(âŸ¨w_i,xâŸ©+(Vs_p(l-1))_i\right)+b_i\right) +(*)\right) \\
 &= H\left(\sum_{k=1}^tÎ²^{t-k}\sum_{l=1}^kÎ±^{k-l}âŸ¨w_i,xâŸ©+\sum_{k=1}^tÎ²^{t-k}\left(Î±^ki_i(0)+b_i+\sum_{l=1}^kÎ±^{k-l}(Vs_p(l-1))_i\right) +(*)\right) \\
 &= H\left(âŸ¨w_i,xâŸ©+\frac{\sum_{k=1}^tÎ²^{t-k}\left(Î±^ki_i(0)+b_i+\sum_{l=1}^kÎ±^{k-l}(Vs_p(l-1))_i\right) +(*)}{\sum_{k=1}^tÎ²^{t-k}\sum_{l=1}^kÎ±^{k-l}}\right) \\
 &= H\left(âŸ¨w_i,xâŸ©+g_i(t;s_p)\right)
\end{align*}
\end{proof}

\begin{lemma}\label{lem:const-regions-cuts}
  Let \(C_{s'}âˆˆC_{Î¦,1}\), we then have
  \[ C_{s'}=\left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=0}}Ï€_i^{-1}([-âˆ,g_i(t;s')))\right) \bigcap \left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=1}}Ï€_i^{-1}([g_i(t;s'),âˆ))\right) \]
\end{lemma}

\begin{proof}[\proofofref{lem:const-regions-cuts}]
  Let \(C_{s'}âˆˆC_{Î¦,1}\) be such a region. We then get
  \begin{align*}
    C_{s'}&=\bigcap_{iâˆˆ[n_1],tâˆˆ[T]}\{x\mid s'_i(t) =s_i(t;x)\} \\
     &=\bigcap_{iâˆˆ[n_1],tâˆˆ[T]}\{x\mid s'_i(t) =s_i(t;x;s')\} \\
     &= \left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=0}}\{x\mid s_i(t;x;s')=0\}\right) \bigcap \left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=1}}\{x\mid s_i(t;x;s')=1\}\right) \\
     &= \left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=0}}Ï€_i^{-1}([-âˆ,g_i(t;s')))\right) \bigcap \left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=1}}Ï€_i^{-1}([g_i(t;s'),âˆ))\right)
  \end{align*}
  by~\cref{lem:invert-p}.
\end{proof}



\begin{lemma}\label{lem:intersection-and-product}
  \(\bigcap_{jâˆˆJ}\prod_{iâˆˆ[n]}M_{i,j}=\prod_{iâˆˆ[n]}\bigcap_{jâˆˆJ}M_{i,j}\) for an index set \(J\) and sets \((M_{i,j})_{iâˆˆ[n],jâˆˆJ}\).
\end{lemma}

\begin{proof}[\proofofref{lem:intersection-and-product}]
  For every \(x=(x_i)_{iâˆˆ[n]}âˆˆMâ‰”\prod_{iâˆˆ[n]}\bigcup_{jâˆˆJ}M_{i,j}\) holds:
  \begin{equation*}
   xâˆˆ\bigcap_{jâˆˆJ}\prod_{iâˆˆ[n]}M_{i,j}â‡”âˆ€_{jâˆˆJ}xâˆˆ\prod_{iâˆˆ[n]}M_{i,j} â‡”âˆ€_{jâˆˆJ}âˆ€_{iâˆˆ[n]}x_iâˆˆM_{i,j}
  \end{equation*}
  On the other hand, we have
  \begin{equation*}
    xâˆˆ\prod_{iâˆˆ[n]}\bigcap_{jâˆˆI}M_{i,j}â‡”âˆ€_{iâˆˆ[n]}x_i\bigcap_{jâˆˆI}M_{i,j}â‡”âˆ€_{iâˆˆ[n]}âˆ€_{jâˆˆJ}x_iâˆˆM_{i,j}
  \end{equation*}
  In total we get
  \[ \bigcap_{jâˆˆJ}\prod_{iâˆˆ[n]}M_{i,j}=Mâˆ©\bigcap_{jâˆˆJ}\prod_{iâˆˆ[n]}M_{i,j}=Mâˆ©\prod_{iâˆˆ[n]}\bigcap_{jâˆˆI}M_{i,j}=\prod_{iâˆˆ[n]}\bigcap_{jâˆˆI}M_{i,j} \]
\end{proof}

\begin{lemma}\label{lem:intersection-cuboid}
  The intersection \(C_1âˆ©C_2\) of half-open cuboids \(C_1,C_2âŠ‚â„^n\) is a half-open cuboid. In particular, if \(C_iâ‰”\prod_{jâˆˆ[n]}[c_{i,j},d_{i,j})\), then
  \[ C_1âˆ©C_2=\prod_{jâˆˆ[n]}([\sup(c_{1,j},c_{2,j}),\inf(d_{1,j},d_{2,j}))) \]
  We use \(\inf/\sup\) instead of \(\min/\max\) to highlight that the components of the vertices might be \(Â±âˆ\).
\end{lemma}

\begin{proof}[\proofofref{lem:intersection-cuboid}]
  %DONE: explicitely show case n=1?
  Let us first regard \(n=1\). For \(c_1,c_2,d_1,d_2âˆˆâ„âˆª\{Â±âˆ\}\) we get
  \begin{align*}
       &x âˆˆ [c_1,d_1)\cap [c_2,d_2) \\
   â‡”{} &c_1,c_2â‰¤x<d_1,d_2 \\
   â‡”{} &xâˆˆ[\sup(c_{1,j},c_{2,j}),\inf(d_{1,j},d_{2,j}))
  \end{align*}
  for \(xâˆˆâ„\) and therefore
  \[ C_1âˆ©C_2=\prod_{jâˆˆ[n]}\left([c_{1,j},d_{1,j})âˆ©[c_{2,j},d_{2,j})\right)=\prod_{jâˆˆ[n]}[\sup(c_{1,j},c_{2,j}),\inf(d_{1,j},d_{2,j})) \]
  by~\cref{lem:intersection-and-product}.
\end{proof}
%DONE: remark, we do allow empty cuboids?

%TODO: define cuboid/half-open?

\begin{comment}
\begin{lemma}\label{lem:pre-image-half-open-int}
  Let \([c,d)\) be a half-open interval and \(Ï†:â„â†’â„\) be an affine linear function. Then \(Ï†^{-1}([c,d))\) is a half-open interval.
\end{lemma}

\begin{proof}
  If \(Ï†\) is constant, then \(Ï†^{-1}([c,d))\) is either \(â„=[-âˆ,âˆ)\) or \(âˆ…=[0,0)\).
  If \(Ï†\) is not constant, then \(Ï†=ax+b\) with \(a>0\) and \(Ï†^{-1}([c,d))=[\frac{c-b}{a},\frac{d-b}{a})\), if \(c,dâˆˆâ„\); if \(c=-âˆ\) or \(d=âˆ\) the lower limit or upper limit of \(Ï†^{-1}([c,d))\) is \(-âˆ\) or \(âˆ\) respectively.
\end{proof}
\end{comment}

\begin{proof}[\proofofref{prop:const-regions-cuboids}]
  Let \(C_{s'}âˆˆC_{Î¦,1}\) be a constant region. We then get
  \begin{align*}
   C_{s'}&=\left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=0}}Ï€_i^{-1}([-âˆ,g_i(t;s')))\right) \bigcap \left(\bigcap_{\substack{iâˆˆ[n_1],tâˆˆ[T] \\ s'_i(t)=1}}Ï€_i^{-1}([g_i(t;s'),âˆ))\right) \\
         &=\prod_{iâˆˆ[n]}[\sup_{tâˆˆ[T],\ s'_i(t)=1}g_i(t;s'), \inf_{tâˆˆ[T],\ s'_i(t)=0}g_i(t;s'))
  \end{align*}
  by~\cref{lem:const-regions-cuts} and~\cref{lem:intersection-cuboid}, since
  \[ Ï€_i^{-1}([c,d))=[-âˆ,âˆ)Ã—â€¦Ã—[c,d)Ã—â€¦Ã—[-âˆ,âˆ). \]
  So \(C_{s'}\) is a finite intersection of half-open cuboids. We can now apply~\cref{lem:intersection-cuboid} and obtain that \(C_{s'}\) is indeed a half-open cuboid.
\end{proof}

We will add an ordering to spike trains based on lexicographical ordering. We define \(s'â‰¤_ls''\) for \(s',s''âˆˆ\{0,1\}^{n_1Ã—T}\) to mean that either \(s'=s''\) or \(s'(t)<s''(t)\) holds for the minimal time \(t\) such that the spike trains have different values.

\begin{lemma}
  Let us regard a \rdtlifsnn \(Î¦\) with \(W=I_{n_1}\).
  Let further \(x,yâˆˆâ„^{n_0}\). We then have \(xâ‰¤yâ‡’s(Â·;x)â‰¤s(Â·;y)\).

  Is on the other hand \(s(Â·;x)<s(Â·;y)\) lexicographicaly, so \(x_i<y_i\) with \(iâˆˆ[n_1]\), such that \(t\) is the smallest time with \(âˆƒ_{iâˆˆ[n_1]}s_i(t;x)â‰ s_i(t;y)\).
\end{lemma}

% TODO: introduce a<b means aâ‰¤b and âˆƒ_i(a_i<b_i)
% TODO: generalize
% TODO: proof using Prop 4.1?
\begin{proof}
  Let \(xâ‰¤y\) and \(s(Â·;x)â‰ s(Â·;y)\). We then have a minimal \(tâˆˆ[T]\) such \(s(t;x)â‰ s(t;y)\). Now due to \(âˆ€_{t'<t}s(t';x)=s(t';y)\) and~\cref{rem:regions-non-recursive-defs} we have \(âˆ€_{iâˆˆ[n_1]}s_1(t;x_i)â‰¤s_i(t;y_i)\) and therefore \(s(t;x)<s(t;y)\).

  Let now \(s(Â·;x)<s(Â·;y)\). Then there is a smallest time \(t\) such that \(âˆƒ_{iâˆˆ[n_1]}s_i(t;x)â‰ s_i(t;y)\). By definition of the ordering on spike trains we get \(s_i(t;x)<s_i(t;y)\). Now \(s_{i;s_p}(t;x_i)\) is a monotone function in \(x_i\) with \(s_p(t)â‰”s(t;x)\) by choice of \(t\) and~\cref{rem:regions-non-recursive-defs}. We therefore have \(x_i<y_i\)
\end{proof}

\begin{lemma}\label{lem:inf-regions}
  Let \(s'âˆˆ\{0,1\}^{n_1Ã—T}\) such that \(âˆ€_{iâˆˆ[n_1]}âˆ€_{t,t'âˆˆ[T]}s'_i(t)=s'_i(t')\). Let further \(C_{s'}=âŸ¦x^{s'},y^{s'}â¦†\) be the corresponding region. Then \(C_{s'}\) is non-empty, i.e. \(âˆ€_{iâˆˆ[n_1]}x^{s'}_i<y^{s'}_i\), and \(x^{s'}_i=-âˆ\) exactly if \(âˆ€_{tâˆˆ[T]}s'_i(t)=0\) and \(y^{s'}_i=âˆ\) exactly if \(âˆ€_{tâˆˆ[T]}s'_i(t)=1\) for all \(iâˆˆ[n_1]\).

  Furthermore, \(C_{s'}\) has exactly one finite vertex.
\end{lemma}

\begin{proof}
  By~\cref{rem:regions-non-recursive-defs} \(p_{i;s_p}(t;x)\) is a non-constant linear function for \(tâ‰¥1\) and fixed \(s_p\). We have therefore \(âˆƒ_zs_{i;s_p}(t;(-âˆ,z_i))=0\) and \(âˆƒ_zs_{i;s_p}(t;[z_i,âˆ))=1\) for any fixed \(tâˆˆ[T]\) and \(s_p\). Since there are only finitely many time-steps \(tâˆˆ[T]\) and spike trains \(s_p\) and, we get \(s_{i;s_p}(t;(-âˆ,z_i))=0\) or \(s_{i;s_p}(t;[z_i,âˆ))=1\) respectively for any \(s_p\) and \(tâˆˆ[T]\), as well as any \(z\) with \(z_i\) small or large enough.

  By choosing the component \(z_i\) correctly small or large enough we therefore get a \(zâˆˆC_{s'}\). We further get for any \(iâˆˆ[n_1]\) that if \(âˆ€_ts'_i(t)=0\), then by construction \(s_i(t;(-âˆ,z_i))=1\), so \(âˆ€_{Î´>0}z-Î´e_iâˆˆC_{s'}\) and therefore \(x_i=-âˆ\). If on the other hand \(âˆ€_ts'_i(t)=1\), then \(s_i(t;[z_i,âˆ))=0\), so \(âˆ€_{Î´â‰¥0}z+Î´e_iâˆˆC_{s'}\) and therefore \(y_i=âˆ\).

  Since \(Tâ‰¥1\) by definition, we have either \(x^{s'}_i=-âˆ\) or \(y^{s'}_i=âˆ\) by definition of \(s'\) for each \(iâˆˆ[n_1]\). By choosing the only finite one from \(\{x^{s'}_i,y^{s'}_i\}\) for each \(iâˆˆ[n_1]\) we get the only finite vertex of \(C_{s'}\).
\end{proof}

%TODO: compute rough position
\begin{lemma}\label{lem:region-vertex}
  If \(qâˆˆâ„^{n_1}\) is a (finite) vertex of a region \(C_{s'}=âŸ¦x^{s'},y^{s'}â¦†âˆˆC_{Î¦,1}\), \(s'âˆˆ\{0,1\}^{n_1Ã—T}\), then \(âˆ€_{iâˆˆ[n_1]}âˆ€_{Î´>0}s_i(Â·;q)â‰ s_i(Â·;q-Î´(âˆ‚_q)_ie_i)\).
  Here \(âˆ‚_qâ‰”2H(x^{s'}+y^{s'}-2q)-1\) points is a vector pointing from \(q\) roughly in the direction of the opposite vertex of the cube \(C_{s'}\) (We allow \(x^{s'},y^{s'}\) to have \(-âˆ\) or \(âˆ\) as components here).
\end{lemma}

\begin{proof}
  Proof by contradiction: If the statement is wrong, than there exists an \(iâˆˆ[n_1]\), such that for every \(Î´>0\) with \(s_i(Â·;q)=s_i(Â·;q-Î´(âˆ‚_q)_ie_i)\).
  Since the other components of \(p(Â·;x)\) as well as \(s(Â·;x)\) are only affected by the value of \(x_i\) through \(s_i(Â·;x)\) we further get \(s(Â·;q)=s(Â·;q-Î´(âˆ‚_q)_ie_i)\). So \(q-Î´(âˆ‚_q)_ie_iâˆˆC_{s'}\).

  On the other hand \(x^{s'}_iâ‰¤q_i-Î´(âˆ‚_q)_i<y^{s'}_i\) cannot be true: Assume that it is. Since \(q\) is a (finite) vertex of \(âŸ¦x^{s'},y^{s'}â¦†\), we have \(q_iâˆˆ\{x^{s'}_i,y^{s'}_i\}\). Case distinction: Suppose \(q_i=x^{s'}_i\). Then \((âˆ‚_q)_i=1\) and \(x^{s'}_iâ‰¤q_i-Î´(âˆ‚_q)_i\) is wrong. Suppose on the other hand \(q_i=y^{s'}_i\). Then \((âˆ‚_q)_i=-1\) and \(q_i-Î´(âˆ‚_q)_i<y^{s'}_i\) is wrong.
\end{proof}

% I'm an idiot. The proposition I tried to proof is wrong and I could've checked it with my website in 5min
\begin{comment}

  % TODO: not essential/not actually needed in proof? still leave it?
\begin{lemma}\label{lem:convex-closure}
  Let \(MâŠ‚â„^n\) be convex. Then the closure \(\overline{M}\) is convex as well.
\end{lemma}

\begin{proof}
  Let \(x,yâˆˆ\operatorname{M}\) and \(tâˆˆ[0,1]\). We will proof \(zâ‰”x+(y-x)tâˆˆ\operatorname{M}\). By definition of the closure have sequences \((x_n)_{nâˆˆâ„•},(y_n)_{nâˆˆâ„•}âŠ‚M\) with \(x_nâ†’x\), \(y_nâ†’y\) for \(nâ†’âˆ\). We get a corresponding sequence \(z_nâ‰”x_n+(y_n-x_n)t\) with \(z_nâ†’z\), since
  \begin{align*}
   \abs{z-z_n} &=\abs{(x-x_n)(1-t)+(y-y_n)t} \\
               &â‰¤(1-t)\abs{x-x_n}+t\abs{y-y_n} \\
               &â†’0
  \end{align*}
  for \(nâ†’âˆ\).
\end{proof}

%TODO: remove collission of notation for H
\begin{lemma}\label{lem:sep-conv-set-and-point-by-hypr}
  Let \(MâŠ‚â„^n\) and \(xâˆˆâ„^mâˆ–\overline{\operatorname{conv}(M)}\). Then there exists an affine hyperplane \(HâŠ‚â„^m\) with \(xâˆˆH\) and \(Hâˆ©\operatorname{conv}(M)=âˆ…\).
\end{lemma}

% TODO: image
\begin{proof}
  Let now \(Î´=\operatorname{dist}(x,\operatorname{conv}(M))â‰”\inf_{yâˆˆ\operatorname{conv}(M)}(\norm{x-y}_2)\). We clearly have \(Î´>0\), since otherwise \(xâˆˆ\operatorname{\operatorname{conv(M)}}\). Let \((y_n)_{nâˆˆâ„•}\) be a sequence with \(\norm{x,y_n}_2â†’Î´\) for \(nâ†’âˆ\). Since \(â„^n\) is complete we can assume w.l.o.g. that \((y_n)_n\) converges to \(yâˆˆâ„^n\). We now choose \(Hâ‰”x+\{zâˆˆâ„^n\mid âŸ¨z,x-yâŸ©=0\}\). This is indeed a hyperplane, since \(\norm{x-y}_2=Î´>0\) and therefore \(xâ‰ y\).

  Suppose there is a \(zâˆˆHâˆ©\operatorname{conv}(M)\). We then have \(y'â‰”y+(z-y)\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}\). By using \(\norm{Â·}_2^2=âŸ¨Â·,Â·âŸ©\) we get
  \[ \norm{x-y'}_2^2=\norm{x-y-(z-y)\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}}_2^2=\norm{x-y}_2^2-\norm{(z-y)\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}}_2^2 \]
  since \(x-y'âŠ¥y'-y\):
  \begin{align*}
    &âŸ¨x-y',(z-y)\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}âŸ© \\
    &=\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}âŸ¨x-y-(z-y)\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2},z-yâŸ© \\
    &=\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}âŸ¨x-y,z-yâŸ©-\frac{âŸ¨x-y,z-yâŸ©^2}{\norm{z-y}_2^4}âŸ¨z-y,z-yâŸ© \\
    &=0
  \end{align*}
  So \(\norm{x-y'}_2<\norm{x-y}_2=Î´\), since \(xâ‰ y\) and \(zâ‰ y\) (\(yâˆ‰H\)). We further have \(\operatorname{dist}(y',\operatorname{conv}(M))=0\):

  First notice that \(0â‰¤\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}<1\). Since \(zâˆˆH\), we have \(âŸ¨z-x,x-yâŸ©=0\) and therefore \(\norm{x-y}_2^2+\norm{z-x}^2_2=\norm{z-y}_2^2\), so we get
  \[ âŸ¨x-y,z-yâŸ©â‰¤\norm{z-y}\norm{x-y}<\norm{z-y}^2 \]
  by the Cauchy-Schwarz-Inequality and \(zâ‰ x\). Notice that we can proof \(\frac{âŸ¨z-x,z-yâŸ©}{\norm{z-y}_2^2}<1\) in the same way.
  Since we have \(\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}+\frac{âŸ¨z-x,z-yâŸ©}{\norm{z-y}_2^2}=1\) we get \(0â‰¤\frac{âŸ¨x-y,z-yâŸ©}{\norm{z-y}_2^2}\).

  %TODO: notation [y,z]
  So \(y'âˆˆ[y,z]âŠ‚\overline{\operatorname{conv}(M)}\) by~\cref{lem:convex-closure}.

  So there are \(y''âˆˆ\operatorname{conv}(M)\) with \(\norm{y''-y'}_2<Î´-\norm{x-y'}_2\) and we get \(\norm{x-y''}<Î´\). This contradicts the definition of \(Î´\).
\end{proof}

\begin{lemma}\label{lem:pov-hyprplane}
  If \(HâŠ‚â„^n\) is an affine hyperplane, then there exists a dimension \(iâˆˆ[n]\) such that \(Ï€_{[n]âˆ–\{i\}}(H)=â„^{n-1}\).
\end{lemma}

%TODO: intuition there is pov such that the plane appears to cover everything

\begin{proof}
  Suppose this is not the case. Let \(xâˆˆH\). Then \(0â‰ \ker(Ï€_{[n]âˆ–\{i\}}|_{H-x})âŠ‚\ker(Ï€_{[n]âˆ–\{i\}}|_{â„^n})â‰…â„\), and therefore \(e_iâˆˆH-x\). But this contradicts \(H-x\) having dimension \(n-1\).
\end{proof}

%TODO: general assumption W=I_{n_1}
\begin{proposition}
  Let \(P\) be the set of all finite vertices of regions \(C_{s'}\), \(s'âˆˆ\{0,1\}^{n_1Ã—T}\), with \(âˆ€_{iâˆˆ[n_1]}âˆ€_{t,t'âˆˆ[T]}s'_i(t)=s'_i(t')\). Then all (finite) vertices of the constant regions \(C_{s'}âˆˆC_{Î¦,1}\) with \(W=I_{n_1}\) are contained in the convex hull of \(P\).

  We further have \(\operatorname{conv}(P)âŠ‚[a,b]\) where
  %TODO: improve inequalities
  \begin{align*}
   a &â‰” \\
   b &â‰”\max(-Î²u(0)-Î±i(0),)+(-b)+Ï‘Â·ğŸ™_{n_1}
  \end{align*}
  % where \(a_0\) is the higher vertex of the region \(C_0â‰”\{xâˆˆâ„^{n_0}\mid âˆ€_{tâˆˆ[T]}s(t;x)=0\}\), \(C_0=âŸ¦a_0,b_0â¦†\), with constant \(0\) spike train and \(b_1\) is the lower vertex of the region \(C_1â‰”\{xâˆˆâ„^{n_0}\mid âˆ€_{tâˆˆ[T]}s(t;x)=1\}\), \(C_1=âŸ¦a_1,b_1â¦†\) with constant \(1\) spike train.
\end{proposition}

%TODO: add image

%TODO: add name for spike trains/regions with constant spike trains, simplify proofs/propositions

\begin{proof}
  %TODO: put in proposition
  We will first proof that if \(xâˆˆâ„^{n_1}\) is a point with \(âˆƒ_{iâˆˆ[n_1]}âˆƒ_{t,t'âˆˆ[T]}s'_i(t)â‰ s'_i(t')\), then \(xâˆˆ\operatorname{conv}(P)\). Suppose \(xâˆ‰\operatorname{conv}(P)\). Then there is an affine hyperplane \(HâŠ‚â„^{n_1}âˆ–\operatorname{conv}(P)\) with \(xâˆˆH\) by~\cref{lem:sep-conv-set-and-point-by-hypr}. We further have by~\cref{lem:pov-hyprplane}, that there is a dimension \(i'âˆˆ[n]\) such that \(Ï€_{[n]âˆ–\{i'\}}(H-x)=â„^{n-1}\). So \(x+e_{i'}âˆ‰H\) and we have a vector \(x+yâˆˆH\) such that \(âˆ€_{iâˆˆ[n]âˆ–\{i'\}}y_iâ‰ 0\). If possible we choose \(y\) such that \(y_{i'}â‰ 0\). If, not we get \(Ï€_{i'}(H)=x_i\).

  Let us now regard the region \(C_{s_y}\), where we define \(s_y\) such that \(âˆ€_{iâˆˆ[n]âˆ–\{i\}}âˆ€_{tâˆˆ[T]}(s_y)_i(t)=1â‡”y_iâ‰¥0â‡”y_i>0\), and \(âˆ€_t(s_y)_{i'}(t)=1\) exactly when \(y_i>0\) if \(y_iâ‰ 0\) and else if \(âˆƒ_{qâˆˆ\operatorname{conv}(P)}(q+[0,âˆ)e_{i'})âˆ©Hâ‰ âˆ…\) is true.

  By definition of \(s_y\) we can apply~\cref{lem:inf-regions} and obtain that \(C_{s_y}\) has one finite vertex \(zâˆˆP\), that \(C_{s_y}=âŸ¦x^{s_y},y^{s_y}â¦†\) with \(âˆ€_{iâˆˆ[n_1]}(x^{s_y})_i<(y^{s_y})_i\) and \(x^{s_y}_i=-âˆ\) if \(âˆ€_{tâˆˆ[T]}(s_y)_i(t)=0\) as well as \(y^{s_y}_i=âˆ\) if \(âˆ€_{tâˆˆ[T]}(s_y)_i(t)=1\) for all \(iâˆˆ[n_1]\). So by definition of \(s_y\) there exists a \(Î´>0\) such that \(âˆ€_{iâˆˆ[n]âˆ–i'}(x+Î´y)_iâˆˆ[x^{s_y}_i,y^{s_y}_i)\). If \(y_iâ‰ 0\), there even exists \(Î´>0\) with \(âˆ€_{iâˆˆ[n]âˆ–i'}(x+Î´y)_iâˆˆ[x^{s_y}_i,y^{s_y}_i)\), so \(x+Î´yâˆˆC_{s_y}\) and similarly \(x-Î´yâˆˆC_{s_{-y}}\).

  We will now proof \(x+Î´yâˆˆC_{s_y}\) and \(x-Î´yâˆˆC_{s_{-y}}\) for \(y_i=0\): First note that if \(âˆƒ_{qâˆˆ\operatorname{conv}(P)}(q+[0,âˆ)e_{i'})âˆ©Hâ‰ âˆ…\) is false, we instead get \((q-[0,âˆ)e_{i'})âˆ©Hâ‰ âˆ…\), since there exists a \(zâˆˆH\) with \(Ï€_{[n]âˆ–\{i'\}}(z)=Ï€_{[n]âˆ–\{i'\}}(q)\).
  Furthermore if \((q+[0,âˆ)e_{i'})âˆ©Hâ‰ âˆ…\) is true for any \(qâˆˆ\operatorname{conv}(H)\), it is true for all points in \(\operatorname{conv}(P)\): Let \(zâˆˆ(q+[0,âˆ)e_{i'})âˆ©H\) and \(q'âˆˆ\operatorname{conv}(P)\) be another such point. We then have \(z'âˆˆH\) such that \(Ï€_{[n]âˆ–\{i'\}}(z')=Ï€_{[n]âˆ–\{i'\}}(q')\). Suppose \(z'âˆˆq'-[0,âˆ)e_{i'}\), we have \([q,q']âŠ‚\operatorname{conv}(P)\) and \([z,z']âŠ‚H\) with \([q,q']âˆ©[z,z']â‰ âˆ…\)\comment{TODO: explain this?}, but \(\operatorname{conv}(P)âˆ©H=âˆ…\).

  Case distinction: Let \(âˆ€_{tâˆˆ[T]}(s_y)_{i'}(t)=0\). We then have \((z-[0,âˆ)e_{i'})âˆ©Hâ‰ âˆ…\). By choice of \(y\), we have \(Ï€_{i'}(H)=x_{i'}\) and therefore \(x_{i'}â‰¤z_{i'}\). Since \(âˆ€_{tâˆˆ[T]}(s_y)_{i'}(t)=0\), we have \(x_{i'}^{s_y}=-âˆ\) and therefore \((x+Î´y)_{i'}=x_{i'}âˆˆ[x_{i'}^{s_y}, z_{i'})=[x_{i'}^{s_y},y_{i'}^{s_y})\).
  %TODO: note on the meaning of [-âˆ,x)

  Let now \(âˆ€_{tâˆˆ[T]}(s_y)_{i'}(t)=1\). We then have \((z+[0,âˆ)e_{i'})âˆ©Hâ‰ âˆ…\). By choice of \(y\), we have \(Ï€_{i'}(H)=x_{i'}\) and therefore \(z_{i'}â‰¤x_{i'}\). Since \(âˆ€_{tâˆˆ[T]}(s_y)_{i'}(t)=1\), we have \(y_{i'}^{s_y}=âˆ\) and therefore \((x+Î´y)_{i'}=x_{i'}âˆˆ[z_{i'},y_{i'}^{s_y})=[x_{i'}^{s_y},y_{i'}^{s_y})\).

  So we get in both cases \(x+Î´yâˆˆC_{s_y}\) and in the same way \(x-Î´yâˆˆC_{s_{-y}}\).
\end{proof}
\end{comment}

%DONE: use âŸ¦â¦† notation

\begin{lemma}
  Points \(xâˆˆâ„^{n_1}\) with only non-constant spiketrains, i.e. \(âˆ€_{iâˆˆ[n_1]}âˆƒ_{t,t'âˆˆ[T]}s_i(t;x)â‰ s_i(t';x)\) are contained in regions \(C_{s'}\) with only finite vertices.
\end{lemma}

%TODO: define finite vertice, define vertice

\begin{proof}
  %TODO: use prop 4.1
\end{proof}

\begin{proposition}
  Let \(P\) be the set of all finite vertices of regions \(C_{s'}\), \(s'âˆˆ\{0,1\}^{n_1Ã—T}\), with constant spiketrains, i.e. \(âˆ€_{t,t'âˆˆ[T]}s'(t)=s'(t')\).
  % TODO: Then all (finite) vertices of the constant regions \(C_{s'}âˆˆC_{Î¦,1}\)
  Then all points \(xâˆˆâ„^{n_1}\) with only non-constant spiketrains, i.e. \(âˆ€_{iâˆˆ[n_1]}âˆƒ_{t,t'âˆˆ[T]}s_i(t;x)â‰ s_i(t';x)\), are contained in \(âŸ¦x^C,y^Câ¦†\), where

  \begin{align*}
   x^C_i &â‰” \min_{\substack{tâˆˆ[T],\ s_pâˆˆ\{0,1\}^{n_1Ã—T}\\ âˆ€_{tâˆˆ[T]}(s_p)_i(t)=0}}g(t;s_p) \\
   y^C_i &â‰” \max_{\substack{tâˆˆ[T],\ s_pâˆˆ\{0,1\}^{n_1Ã—T} \\ âˆ€_{tâˆˆ[T]}(s_p)_i(t)=1}}g(t;s_p)
  \end{align*}
  We get in particular
  %TODO: geometric series
  \begin{align*}
    x^C &= \min_{tâˆˆ[T]}\left(-\frac{\sum_{k=1}^tÎ²^{t-k}(Î±^ki(0)+b-Ï‘ğŸ™) +Î²^tu(0)}{\sum_{k=1}^tÎ²^{t-k}\sum_{l=1}^kÎ±^{k-l}}-1_{tâ‰ 1}\max(V,0)ğŸ™_{n_1}\right) \\
    y^C &= \max_{tâˆˆ[T]}\left(-\frac{\sum_{k=1}^tÎ²^{t-k}(Î±^ki(0)+b-Ï‘ğŸ™) +Î²^tu(0)}{\sum_{k=1}^tÎ²^{t-k}\sum_{l=1}^kÎ±^{k-l}}-1_{tâ‰ 1}\min(V,0)ğŸ™_{n_1}\right)
  \end{align*}
  Here \(\max(V,0)\) is component-wise application of \(\max(Â·,0)\) on \(V\). The expression \(\min(V,0)\) is defined analogously.
\end{proposition}

\begin{proof}
  Let \(iâˆˆ[n_1]\) and \(xâˆˆâ„^{n_1}\) be given with \(s^xâ‰”s(Â·;x)\) and \(âˆ€_{t,t'âˆˆ[T]}s^x_i(t)=s^x_i(t')\). If \(s_i^x=0\), then \(x_i<\inf_{\substack{tâˆˆ[T]}}g_i(t;s^x)â‰¤x^C_i\).
  We similarly get \(x^C_iâ‰¤\sup_{\substack{tâˆˆ[T]}}g_i(t;s^x)â‰¤x_i\) for \(s_i^x=1\).
  So \(xâˆ‰âŸ¦x^C,y^Câ¦†\) if \(x\) has a constant spiketrain in one component.
  %TODO: â€¦
\end{proof}

% TODO: lexiographic ordering even in general case (with specific def.) and

% TODO: the regions appear only between â€¦

% TODO: generalize for W arbitrary

% TODO: show that limit can be reached/refer to previous paper

% \begin{lemma}
%   For \(yâˆˆâ„^{n_0}\) the mapping \(f_y:â„â†’\{0,1\}^T\) defined by \(xâ†¦s_i\) with \(s^{[0]}(t)=y+xe_i\) is monotone regarding lexical ordering.
% \end{lemma}

\begin{comment}
% TODO: motivation for theorem
While in theory we would expect the number of constant regions to grow exponentially with time, it grows only quadratically.

\begin{theorem}\label{thm:bound-regions}
A \rdtlifsnn with \(W=I_{n_1}\), â€¦ has at a maximum \((\frac{T^2+T}{2}+1)^n\) different constant regions.
\end{theorem}

\begin{proof}
  Since the number of constant regions of a \rdtlifsnn are just unions of the constant regions of the corresponding first layer, it suffices to compute the maximum number of constant regions of that layer.

  Let us consider by how much the regions can increase going from \(t-1\) to \(tâˆˆ[T]\). We can categorize the regions at \(t-1\) by the number of spikes they have in each component. We shall write \(C_{Ïƒ,t-1}\) for the region with sums \((Ïƒ_1,â€¦,Ïƒ_{n_1})=Ïƒâˆˆ[t-1]_0^{n_1}\) at time-step \(t-1\). Let further \(C_{Î£,t-1}â‰”\{C_{Ïƒ,t-1}\mid Ïƒâˆˆ[t-1]_0^{n_1}\}\). By definition we have \(\abs{C_{Î£,t-1}}â‰¤t^{n_1}\)..

  We will now show in each region \(C_{Ïƒ,t-1}\) only
\end{proof}
% Bobachtungen:
% In den Regionen zwischen Kreuzen ist die Anzahl der gestapelten Regionen nie grÃ¶ÃŸer gleich T
% In den Regionen um die Kreuze Ã¤hnliches

% Ãœberlegungen
% Regionen mit gleicher spike train in einer komponente anschauen, mit linien vergleichen?
% TODO: comparison with Î²=1.5

\begin{corollary}
  %TODO: versions for W arbitrary
\end{corollary}

\begin{proof}
\end{proof}

%TODO: Î²<1 is essential
\end{comment}

%TODO: add depth-search to website
